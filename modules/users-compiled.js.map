{"version":3,"sources":["users.js"],"names":[],"mappings":"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","file":"users-compiled.js","sourcesContent":["var express = require(\"express\");\r\nvar wrap = require(\"co-express\");\r\nvar xlsx1 = require('node-xlsx');\r\nvar fs = require('fs');\r\nvar excel = require('excel-export');\r\nvar XLSX = require('xlsx');\r\nvar xl = require('node-xlrd');\r\nvar xl2 = require('../node_modules/xlsx-master/index');\r\nvar ejsExcel = require(\"ejsexcel\");\r\nvar exlBuf = fs.readFileSync(\"./modules/template2.xlsx\");\r\nvar db = require(\"./db\");\r\nvar ObjectId = require(\"mongodb\").ObjectID;\r\nvar _ =require(\"lodash\");\r\nvar router = express.Router();\r\n\r\nvar users=db.collection(\"users\");\r\n\r\nrouter.get('/',wrap(function* (req,res,next){\r\n    var userDatas= yield users.find().toArrayAsync();\r\n    _.each(userDatas,function(row){\r\n        row.id=row._id;\r\n        delete row._id;\r\n    });\r\n    res.send(userDatas);\r\n}));\r\n\r\nrouter.post('/',wrap(function* (req,res,next){\r\n    var user= req.body;\r\n    var rs= yield users.insertAsync(user);\r\n    var id= rs.insertedIds[0];\r\n    res.send({newid:id});\r\n}));\r\n\r\nrouter.put('/:id',wrap(function* (req,res,next){\r\n    var id=req.param(\"id\");\r\n    var oid=new ObjectId(id);\r\n    var user= req.body;\r\n    delete user.id;\r\n    var rs= yield users.updateAsync({_id:oid},user);\r\n    res.send({});\r\n}));\r\n\r\nrouter.delete('/:id',wrap(function* (req,res,next){\r\n    var id=req.param(\"id\");\r\n    var oid=new ObjectId(id);\r\n    var rs= yield users.deleteOneAsync({_id:oid});\r\n    res.send({});\r\n}));\r\n\r\nrouter.get('/export1', wrap(function* (req, res,next){\r\n    //var obj = {\"worksheets\":[{\"data\":[[\"姓名\",\"性别\",\"年龄\"],[\"李晓龙\",\"男\",\"24\"]]}]};\r\n    //var file = xlsx.build(obj);\r\n    //var data = [[1,2,3],[true, false, null, 'sheetjs'],['foo','bar',new Date('2014-02-19T14:30Z'), '0.3'], ['baz', null, 'qux']];\r\n    var userDatas= yield users.find().toArrayAsync();\r\n    var data = [];\r\n    var pros = [];\r\n    if(userDatas.length){\r\n        for(var pro in userDatas[0]){\r\n            pros.push(pro);\r\n        }\r\n    }\r\n    data.push(pros);\r\n    for(var i = 0; i < userDatas.length; i++){\r\n        var row = [];\r\n        for(var j = 0; j < pros.length; j++){\r\n            row.push(userDatas[i][pros[j]])\r\n        }\r\n        data.push(row);\r\n    }\r\n    var box = xlsx1.parse('./modules/template2.xlsx');\r\n    //box[0].data = data;\r\n    //var buffer = xlsx1.build([{name: \"mySheetName\", data: data}]);\r\n    var buffer = xlsx1.build(box);\r\n    //fs.writeFileSync('./public/temp/user.xlsx', buffer, 'binary');\r\n    //res.send('user.xlsx');\r\n    res.setHeader('Content-Type', 'application/vnd.openxmlformats');\r\n    res.setHeader(\"Content-Disposition\", \"attachment; filename=\" + \"Report.xlsx\");\r\n    res.end(buffer, 'binary');\r\n}));\r\n\r\nrouter.get('/export2', wrap(function* (req, res,next){\r\n    var conf = {};\r\n    conf.name = \"mysheet1\";\r\n    conf.cols = [\r\n        {caption:'string', type:'string', captionStyleIndex: 1, width:28},\r\n        {caption:'date', type:'date', },\r\n        {caption:'bool', type:'bool', },\r\n        {caption:'number', type:'number', }\r\n    ];\r\n    conf.rows = [\r\n        ['pi', (new Date(2013, 4, 1)).getJulian(), true, 3.14],\r\n        [\"e\", (new Date(2012, 4, 1)).getJulian(), false, 2.7182]\r\n    ];\r\n    //conf.stylesXmlFile = \"styles.xml\";\r\n    /*conf.name = \"mysheet\";\r\n    conf.cols = [{\r\n        caption:'string',\r\n        type:'string',\r\n        beforeCellWrite:function(row, cellData){\r\n            return cellData.toUpperCase();\r\n        },\r\n        width:28\r\n    },{\r\n        caption:'date',\r\n        type:'date',\r\n        beforeCellWrite:function(){\r\n            var originDate = new Date(Date.UTC(1899,11,30));\r\n            return function(row, cellData, eOpt){\r\n                if (eOpt.rowNum%2){\r\n                    eOpt.styleIndex = 1;\r\n                }\r\n                else{\r\n                    eOpt.styleIndex = 2;\r\n                }\r\n                if (cellData === null){\r\n                    eOpt.cellType = 'string';\r\n                    return 'N/A';\r\n                } else\r\n                    return (cellData - originDate) / (24 * 60 * 60 * 1000);\r\n            }\r\n        }()\r\n    },{\r\n        caption:'bool',\r\n        type:'bool'\r\n    },{\r\n        caption:'number',\r\n        type:'number'\r\n    }];\r\n    conf.rows = [\r\n        ['pi', new Date(Date.UTC(2013, 4, 1)), true, 3.14],\r\n        [\"e\", new Date(2012, 4, 1), false, 2.7182],\r\n        [\"M&M<>'\", new Date(Date.UTC(2013, 6, 9)), false, 1.61803],\r\n        [\"null date\", null, true, 1.414]\r\n    ];*/\r\n    var result = excel.execute(conf);\r\n    res.setHeader('Content-Type', 'application/vnd.openxmlformats');\r\n    res.setHeader(\"Content-Disposition\", \"attachment; filename=\" + \"Report.xlsx\");\r\n    res.end(result, 'binary');\r\n}));\r\n\r\nrouter.get('/export3', wrap(function* (req, res,next){\r\n    var userDatas= yield users.find().toArrayAsync();\r\n    var data = [];\r\n    var pros = [];\r\n    if(userDatas.length){\r\n        for(var pro in userDatas[0]){\r\n            pros.push(pro);\r\n        }\r\n    }\r\n    data.push(pros);\r\n    for(var i = 0; i < userDatas.length; i++){\r\n        var row = [];\r\n        for(var j = 0; j < pros.length; j++){\r\n            row.push(userDatas[i][pros[j]])\r\n        }\r\n        data.push(row);\r\n    }\r\n    var ws = {\r\n        s:{\r\n            \"!row\" : [{wpx: 67}]\r\n        }\r\n    };\r\n    ws['!cols']= [];\r\n    for(var n = 0; n != data[0].length; ++n){\r\n        ws['!cols'].push({\r\n            wpx: 170\r\n        });\r\n    }\r\n    var range = {\r\n        s : {\r\n            c : 10000000,\r\n            r : 10000000,\r\n        },\r\n        e : {\r\n            c : 0,\r\n            r : 0\r\n        }\r\n    };\r\n    for (var R = 0; R != data.length; ++R) {\r\n        for (var C = 0; C != data[R].length; ++C) {\r\n            if (range.s.r > R)\r\n                range.s.r = R;\r\n            if (range.s.c > C)\r\n                range.s.c = C;\r\n            if (range.e.r < R)\r\n                range.e.r = R;\r\n            if (range.e.c < C)\r\n                range.e.c = C;\r\n            var cell = {\r\n                v : data[R][C],\r\n                s:{\r\n                    fill: { fgColor: { rgb: \"#FF0000\"}},\r\n                    alignment: {horizontal: \"center\" ,vertical: \"center\"},\r\n                }\r\n            };\r\n            if (cell.v == null)\r\n                continue;\r\n            var cell_ref = XLSX.utils.encode_cell({\r\n                c : C,\r\n                r : R\r\n            });\r\n\r\n            if ( typeof cell.v === 'number')\r\n                cell.t = 'n';\r\n            else if ( typeof cell.v === 'boolean')\r\n                cell.t = 'b';\r\n            else if (cell.v instanceof Date) {\r\n                cell.t = 'n';\r\n                cell.z = XLSX.SSF._table[14];\r\n                cell.v = datenum(cell.v);\r\n            } else\r\n                cell.t = 's';\r\n            if(R){\r\n                delete cell.s.fill;\r\n            }\r\n            ws[cell_ref] = cell;\r\n        }\r\n    }\r\n    data.fileName = \"./public/temp/user.xlsx\";\r\n    var workbook = new Workbook();\r\n    var wsName = data.fileName.split(\".xlsx\")[0];\r\n    workbook.SheetNames.push(wsName);\r\n    workbook.Sheets[wsName] = ws;\r\n    if (range.s.c < 10000000)\r\n        ws['!ref'] = XLSX.utils.encode_range(range);\r\n    var wopts = {\r\n        bookType : 'xlsx',\r\n        bookSST : false,\r\n        type : 'binary'\r\n    };\r\n    var wbout = XLSX.write(workbook, wopts);\r\n    XLSX.writeFile(workbook, data.fileName);\r\n    //return wbout;\r\n    res.send(\"user.xlsx\");\r\n}));\r\n\r\nrouter.get('/export4', wrap(function* (req, res, next){\r\n    var data = [\r\n        [{\"table_name\":\"现金报表\",\"date\": '2014-04-09'}],\r\n        [ { \"cb1\":\"001\",\"cb1_\":\"002\",\"bn1\":\"1\",\"bn1_\":\"1\",\"cn1\":\"1\",\"cn1_\":\"1\",\"num1\":\"1\",\"num1_\":\"1\",\r\n            \"cb5\":\"001\",\"cb5_\":\"002\",\"bn5\":\"1\",\"bn5_\":\"1\",\"cn5\":\"1\",\"cn5_\":\"1\",\"num1\":\"1\",\"num5_\":\"1\",\r\n            \"cb10\":\"001\",\"cb10_\":\"002\",\"bn10\":\"1\",\"bn10_\":\"1\",\"cn10\":\"1\",\"cn10_\":\"1\",\"num10\":\"1\",\"num10_\":\"1\",\r\n            \"cb20\":\"001\",\"cb20_\":\"002\",\"bn20\":\"1\",\"bn20_\":\"1\",\"cn20\":\"1\",\"cn20_\":\"1\",\"num20\":\"1\",\"num20_\":\"1\",\r\n            \"cb50\":\"001\",\"cb50_\":\"002\",\"bn50\":\"1\",\"bn50_\":\"1\",\"cn50\":\"1\",\"cn50_\":\"1\",\"num50\":\"1\",\"num50_\":\"1\",\r\n            \"cb100\":\"001\",\"cb100_\":\"002\",\"bn100\":\"1\",\"bn100_\":\"1\",\"cn100\":\"1\",\"cn100_\":\"1\",\"num100\":\"1\",\"num100_\":\"1\"\r\n        },{ \"cb1\":\"001\",\"cb1_\":\"002\",\"bn1\":\"1\",\"bn1_\":\"1\",\"cn1\":\"1\",\"cn1_\":\"1\",\"num1\":\"1\",\"num1_\":\"1\",\r\n            \"cb5\":\"001\",\"cb5_\":\"002\",\"bn5\":\"1\",\"bn5_\":\"1\",\"cn5\":\"1\",\"cn5_\":\"1\",\"num1\":\"1\",\"num5_\":\"1\",\r\n            \"cb10\":\"001\",\"cb10_\":\"002\",\"bn10\":\"1\",\"bn10_\":\"1\",\"cn10\":\"1\",\"cn10_\":\"1\",\"num10\":\"1\",\"num10_\":\"1\",\r\n            \"cb20\":\"001\",\"cb20_\":\"002\",\"bn20\":\"1\",\"bn20_\":\"1\",\"cn20\":\"1\",\"cn20_\":\"1\",\"num20\":\"1\",\"num20_\":\"1\",\r\n            \"cb50\":\"001\",\"cb50_\":\"002\",\"bn50\":\"1\",\"bn50_\":\"1\",\"cn50\":\"1\",\"cn50_\":\"1\",\"num50\":\"1\",\"num50_\":\"1\",\r\n            \"cb100\":\"001\",\"cb100_\":\"002\",\"bn100\":\"1\",\"bn100_\":\"1\",\"cn100\":\"1\",\"cn100_\":\"1\",\"num100\":\"1\",\"num100_\":\"1\"\r\n        }]\r\n    ];\r\n    ejsExcel.renderExcelCb(exlBuf, data, function(exlBuf2){\r\n        fs.writeFileSync(\"./public/temp/report1.xlsx\", exlBuf2);\r\n        res.send('report1.xlsx');\r\n    });\r\n}));\r\n\r\nfunction arrays_equal(a,b) { return !(a<b || b<a); }\r\nrouter.get('/export5', wrap(function* (req, res, next){\r\n    var xls = new xl2();\r\n    xls.loadFile('./modules/template2.xlsx');\r\n    var sheet0 = xls.getSheet(0);\r\n    var data = [];\r\n    data.push([1, \"张三\", \"zhangsan@huawei.com\", \"123\"]);\r\n    data.push([2, \"李四\", \"李四@huawei.com\", \"456\"]);\r\n    for(var i = 0; i < data.length; i++){\r\n        sheet0.write('A' + (i + 2), data[i]);\r\n    }\r\n    //xls.writeFile('./public/temp/test.xlsx');\r\n    //res.send('test.xlsx')\r\n    var buffer = xls.data();\r\n    res.setHeader('Content-Type', 'application/vnd.openxmlformats');\r\n    res.setHeader(\"Content-Disposition\", \"attachment; filename=\" + \"Report.xlsx\");\r\n    res.end(buffer, 'binary');\r\n}));\r\n\r\nfunction Workbook() {\r\n    if(!(this instanceof Workbook)) return new Workbook();\r\n    this.SheetNames = [];\r\n    this.Sheets = {};\r\n}\r\n\r\nmodule.exports = router;"]}